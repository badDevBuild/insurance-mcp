# ä»»åŠ¡æ¸…å•ï¼šä¿é™© MCP æ ¸å¿ƒå¹³å°

**åŠŸèƒ½åˆ†æ”¯**: `001-insurance-mcp-core`
**çŠ¶æ€**: è¿›è¡Œä¸­
**æœ€åæ›´æ–°**: 2025-11-21 - è°ƒæ•´çˆ¬è™«ç­–ç•¥ä¸ºæŒ‰ä¿é™©å…¬å¸ç»´åº¦é‡‡é›†ï¼Œç¬¬ä¸€æœŸèšç„¦å¹³å®‰äººå¯¿

## å®æ–½ç­–ç•¥

æˆ‘ä»¬å°†éµå¾ª"æ•°æ®ä¼˜å…ˆ"ç­–ç•¥å®æ–½ç³»ç»Ÿï¼š
1. **åŸºç¡€æ¶æ„**: è®¾ç½®æ ¸å¿ƒåº“ã€CLI ç»“æ„å’Œæ•°æ®åº“æ¨¡å¼ã€‚
2. **é‡‡é›†å±‚ (US3)**: æ„å»ºçˆ¬è™«ä»¥è·å–åŸå§‹æ•°æ® (PDF)ã€‚æ²¡æœ‰æ•°æ®å°±æ— æ³•æµ‹è¯•è§£æã€‚
3. **å¤„ç†å±‚ (US2)**: æ„å»ºè§£æå™¨å’Œå®¡æ ¸å‘˜ CLIï¼Œå°† PDF è½¬æ¢ä¸ºå¯ä¿¡çš„ Markdownã€‚
4. **æ£€ç´¢å±‚ (US1)**: æ„å»ºç´¢å¼•å™¨å’Œ MCP æœåŠ¡å™¨ä»¥æä¾›å¯ä¿¡æ•°æ®æœåŠ¡ã€‚

æ­¤é¡ºåºç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ¥è‡ªä¸Šä¸€é˜¶æ®µçš„çœŸå®æ•°æ®å¯ä¾›ä½¿ç”¨ã€‚

## ç¬¬ä¸€é˜¶æ®µï¼šè®¾ç½®ä¸åŸºç¡€è®¾æ–½

**ç›®æ ‡**: åˆå§‹åŒ–é¡¹ç›®ç»“æ„ã€ä¾èµ–é¡¹å’Œå…±äº«å®ç”¨ç¨‹åºã€‚

- [x] T001 åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„ (`src/{common,crawler,parser,indexing,mcp_server,cli}`, `tests`, `data`)
- [x] T002 è®¾ç½® Python ç¯å¢ƒ (pyproject.toml/requirements.txt)ï¼ŒåŒ…å« `mcp`, `playwright`, `scrapy`, `pdfplumber`, `chromadb`, `FlagEmbedding`, `typer`ï¼Œå¹¶æ˜ç¡®å®‰è£… playwright æµè§ˆå™¨ (`playwright install`)
- [x] T003 å®ç° `src/common/config.py` (åŠ è½½é…ç½®, DB è·¯å¾„)
- [x] T004 å®ç° `src/common/logging.py` (æ ‡å‡†åŒ–æ—¥å¿—è®¾ç½®)
- [x] T005 å®ç° `src/common/db.py` (SQLite è¿æ¥å’Œ `products` åŠ `policy_documents` è¡¨çš„æ¨¡å¼åˆå§‹åŒ–)
- [x] T006 åˆ›å»º `src/cli/manage.py`ï¼ŒåŒ…å«åŸºæœ¬çš„ `init` å‘½ä»¤ä»¥åˆ›å»º DB è¡¨å’Œæ•°æ®ç›®å½•

## ç¬¬äºŒé˜¶æ®µï¼šåŸºç¡€åº“

**ç›®æ ‡**: è·¨ç”¨æˆ·æ•…äº‹ä½¿ç”¨çš„æ ¸å¿ƒæŠ½è±¡ã€‚

- [x] T007 åœ¨ `src/common/models.py` ä¸­å®ç°ä¸ data-model.md åŒ¹é…çš„ `PolicyDocument` å’Œ `Product` Pydantic æ¨¡å‹
- [x] T008 åœ¨ `src/common/repository.py` ä¸­å®ç° `SQLiteRepository` ç±»ï¼Œç”¨äºå…ƒæ•°æ®çš„ CRUD æ“ä½œ

## ç¬¬ä¸‰é˜¶æ®µï¼šè‡ªåŠ¨åŒ–æ¡æ¬¾é‡‡é›† (ç”¨æˆ·æ•…äº‹ 3)

**ç›®æ ‡**: æŒ‰ä¿é™©å…¬å¸ç»´åº¦è‡ªåŠ¨å‘ç°å¹¶ä¸‹è½½ä¿é™©æ¡æ¬¾ã€‚
**ä¼˜å…ˆçº§**: P2 (é¦–å…ˆå®æ–½ä»¥æä¾›æ•°æ®ç»™ P1 æ•…äº‹)
**ç¬¬ä¸€æœŸèŒƒå›´**: ä»…å®ç°å¹³å®‰äººå¯¿å®˜ç½‘çˆ¬è™«
**çŠ¶æ€**: âœ… **å·²å®Œæˆ 100%** (æ‰€æœ‰åŠŸèƒ½å·²å®ç°)

- [x] T009 [US3] ä½¿ç”¨ Playwright å®ç° `src/crawler/discovery/iac_spider.py`ï¼Œä» IAC æå–äº§å“å…ƒæ•°æ®
  - **çŠ¶æ€**: ğŸ”¶ æš‚ç¼“ - ä¼˜å…ˆä½¿ç”¨å¹³å®‰äººå¯¿å®˜ç½‘çˆ¬è™«ï¼ŒIACçˆ¬è™«ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ
- [x] T009a [US3] å®ç° `src/crawler/discovery/pingan_life_spider.py`ï¼Œä»å¹³å®‰äººå¯¿å®˜ç½‘ (https://life.pingan.com/gongkaixinxipilu/baoxianchanpinmulujitiaokuan.jsp) æå–äº§å“å…ƒæ•°æ®ã€PDFé“¾æ¥
- [x] T009b [US3] æ›´æ–° `src/cli/manage.py`ï¼Œæ·»åŠ  `crawl run` ç»Ÿä¸€å‘½ä»¤ï¼Œæ”¯æŒ `--company pingan-life` å‚æ•°
- [x] T010 [US3] ä½¿ç”¨ Aiohttp å®ç° `src/crawler/acquisition/downloader.py`ï¼Œä¸‹è½½ PDF å¹¶åŒ…å«æŒ‡æ•°é€€é¿é‡è¯•é€»è¾‘ (åˆå§‹å»¶è¿Ÿ 1s, æœ€å¤§ 3 æ¬¡é‡è¯•)
- [x] T011 [US3] å®ç° `src/crawler/pipelines/save_pipeline.py` ä»¥å“ˆå¸Œæ–‡ä»¶ï¼Œä¿å­˜åˆ° `data/raw/{company}/{product_code}/`ï¼Œå¹¶æ›´æ–° SQLite
- [x] T011a [US3] **[æ–°å¢]** å®ç° `src/crawler/pipelines/acquisition_pipeline.py` å®Œæ•´é‡‡é›†ç®¡é“ï¼ˆå‘ç°+ä¸‹è½½+å…¥åº“ï¼‰ï¼Œæ”¯æŒæ™ºèƒ½å»é‡å’Œé”™è¯¯å¤„ç†
- [x] T012 [US3] å‘ `src/cli/manage.py` æ·»åŠ  `crawl discover`, `crawl acquire`, `crawl run` å‘½ä»¤
- [x] T013 [US3] [P] åœ¨ `tests/unit/test_crawler_rules.py` ä¸­æ·»åŠ ä¸‹è½½å™¨é‡è¯•é€»è¾‘çš„å•å…ƒæµ‹è¯•
- [x] T014 [US3] åœ¨ `src/crawler/middleware/compliance.py` ä¸­å®ç° robots.txt åˆè§„æ€§æ£€æŸ¥ (QPS é™åˆ¶å’Œè·¯å¾„è¿‡æ»¤)
- [x] T014a [US3] å®ç°å…¨å±€QPSé™æµå™¨ï¼Œç¡®ä¿ä¸¥æ ¼éµå®ˆFR-008åˆè§„è¦æ±‚
  - å®ç°äº†åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•çš„RateLimiterç±»
  - æ”¯æŒå…¨å±€å’Œæ¯åŸŸåç‹¬ç«‹QPSé™åˆ¶ï¼ˆé»˜è®¤0.8 QPSï¼‰
  - å®ç°äº†ç†”æ–­æœºåˆ¶ï¼ˆ429/403è‡ªåŠ¨è§¦å‘ï¼Œ5åˆ†é’Ÿå†·å´ï¼‰
  - é›†æˆåˆ°PDFDownloaderï¼Œæ‰€æœ‰è¯·æ±‚ç»è¿‡é™æµ
  - é€šè¿‡21ä¸ªå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•éªŒè¯

- [x] T014b [US3] robots.txt åˆè§„æ€§æµ‹è¯•ä¸é€Ÿç‡é™åˆ¶æµ‹è¯•
  - å•å…ƒæµ‹è¯•ï¼šç¦æ­¢è®¿é—®è¢«robotsç¦æ­¢çš„è·¯å¾„ï¼ˆä½¿ç”¨mock robotsè§„åˆ™ï¼‰
  - é›†æˆæµ‹è¯•ï¼šæ¨¡æ‹Ÿ429/403è§¦å‘ç†”æ–­ä¸5åˆ†é’Ÿå†·å´

## ç¬¬å››é˜¶æ®µï¼šæ•°æ®å®¡æ ¸å‘˜æ ¸éªŒ (ç”¨æˆ·æ•…äº‹ 2)

**ç›®æ ‡**: è§£æ PDF å¹¶å¯ç”¨äººå·¥æ ¸éªŒã€‚
**ä¼˜å…ˆçº§**: P1

- [x] T015 [US2] **[å·²å®Œæˆ]** å®ç° `src/parser/layout/analyzer.py` ä»¥æ£€æµ‹ PDF ä¸­çš„åˆ—å¸ƒå±€ (å•æ /åŒæ )
  - ä½¿ç”¨pdfplumberå®ç°åŸºç¡€ç‰ˆé¢åˆ†æ
  - æ£€æµ‹å•æ /åŒæ å¸ƒå±€ã€è¡¨æ ¼ã€å›¾åƒ
  - æä¾›è´¨é‡è¯„åˆ†åŠŸèƒ½
- [x] T016 [US2] **[å·²å®Œæˆ]** ä½¿ç”¨ `markitdown` å®ç° `src/parser/markdown/converter.py` ä»¥ç”Ÿæˆ Markdown
  - é‡‡ç”¨Microsoft markitdownä½œä¸ºä¸»è¦æ–¹æ¡ˆ
  - æ”¯æŒäº§å“æ¡æ¬¾å’Œäº§å“è¯´æ˜ä¹¦ä¸¤ç§æ–‡æ¡£ç±»å‹
  - è½¬æ¢ç»“æœä¿å­˜åˆ°data/processed/ç›®å½•
  - è‡ªåŠ¨æ›´æ–°æ•°æ®åº“ä¸­çš„markdown_contentå­—æ®µ
- [-] T017 [US2] [P] å®ç° `src/parser/ocr/paddle.py` åŒ…è£…å™¨ç”¨äº OCR å›é€€ (å¼€å‘æ—¶å¯ mock)
  - æ³¨ï¼šmarkitdownå·²èƒ½å¤„ç†å¤§éƒ¨åˆ†PDFï¼ŒOCRæš‚ä¸éœ€è¦ï¼Œå·²ç”±Docling/MarkItDownå–ä»£
- [x] T018 [US2] **[å·²å®Œæˆ]** å‘ `src/cli/manage.py` æ·»åŠ  `process` å‘½ä»¤ï¼Œå¯¹ PENDING æ–‡æ¡£è¿è¡Œè½¬æ¢å™¨
  - `process convert`: æ‰¹é‡è½¬æ¢PDFåˆ°Markdown
  - `process analyze`: åˆ†æPDFç‰ˆé¢ç»“æ„
- [x] T019 [US2] **[å·²å®Œæˆ]** å®ç° `src/cli/verify.py` (å®¡æ ¸å‘˜ CLI) ä»¥åˆ—å‡º PENDING æ–‡æ¡£ï¼Œæ˜¾ç¤ºé¢„è§ˆï¼Œå¹¶å°†çŠ¶æ€æ›´æ–°ä¸º VERIFIED/REJECTED
  - `verify list`: åˆ—å‡ºå¾…å®¡æ ¸æ–‡æ¡£
  - `verify preview`: é¢„è§ˆMarkdownè½¬æ¢ç»“æœ
  - `verify approve`: æ‰¹å‡†æ–‡æ¡£
  - `verify reject`: é©³å›æ–‡æ¡£
  - `verify stats`: å®¡æ ¸ç»Ÿè®¡
- [ ] T020 [US2] [P] åœ¨ `tests/unit/test_parser.py` ä¸­æ·»åŠ åŒæ è§£æé€»è¾‘çš„å•å…ƒæµ‹è¯•

## ç¬¬äº”é˜¶æ®µï¼šAI å®¢æˆ·ç«¯æ£€ç´¢ (ç”¨æˆ·æ•…äº‹ 1)

**ç›®æ ‡**: ç´¢å¼•å·²æ ¸éªŒæ•°æ®å¹¶é€šè¿‡ MCP æä¾›æœåŠ¡ã€‚
**ä¼˜å…ˆçº§**: P1

### é˜¶æ®µ5Aï¼šæ•°æ®å‡†å¤‡ä¸ä¼˜åŒ–

- [x] T020a [US1] **[P0]** å®ç° Markdownåå¤„ç†Pipeline (`src/parser/markdown/postprocessor.py`)
  
  **æ¥å£è®¾è®¡**:
  ```python
  class MarkdownPostProcessor:
      def __init__(self, steps: List[str] = None):
          """
          åˆå§‹åŒ–åå¤„ç†å™¨
          
          Args:
              steps: è¦æ‰§è¡Œçš„æ­¥éª¤åˆ—è¡¨ï¼Œé»˜è®¤æ‰§è¡Œæ‰€æœ‰æ­¥éª¤
                     å¯é€‰: ['footnote', 'noise', 'format', 'table', 'enhance']
          """
          self.steps = steps or ['footnote', 'noise', 'format', 'table', 'enhance']
      
      def process(self, md_path: str, output_path: str = None) -> str:
          """
          å¤„ç†Markdownæ–‡ä»¶
          
          Args:
              md_path: è¾“å…¥çš„Markdownæ–‡ä»¶è·¯å¾„
              output_path: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤è¦†ç›–åŸæ–‡ä»¶ï¼‰
          
          Returns:
              å¤„ç†åçš„Markdownå†…å®¹
          """
          pass
      
      def process_content(self, content: str) -> str:
          """å¤„ç†Markdownå†…å®¹å­—ç¬¦ä¸²ï¼ˆç”¨äºæµ‹è¯•ï¼‰"""
          pass
  ```
  
  **æ­¥éª¤ä¸²è”**:
  1. FootnoteInliner: è„šæ³¨å†…è”ï¼ˆæå‡50%æ£€ç´¢æ•ˆæœï¼‰
  2. NoiseRemover: å™ªéŸ³å»é™¤ï¼ˆé¡µçœ‰ã€é¡µè„šã€æ°´å°ï¼‰
  3. FormatStandardizer: æ ¼å¼æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€æ ‡é¢˜å±‚çº§ã€åˆ—è¡¨æ ¼å¼ï¼‰
  4. TableValidator: è¡¨æ ¼éªŒè¯ï¼ˆæ£€æŸ¥è¡Œåˆ—å®Œæ•´æ€§ï¼‰
  5. MarkdownEnhancer: ç»“æ„åŒ–å¢å¼ºï¼ˆä½¿ç”¨enhancer.pyæ¨¡å—ï¼‰
     - ParagraphMerger: åˆå¹¶ä¸å¿…è¦çš„æ–­è¡Œ
     - TitleDetector: è¯†åˆ«æ ‡é¢˜å±‚çº§ï¼ˆ#/##/###ï¼‰
     - ListFormatter: æ ¼å¼åŒ–åˆ—è¡¨
     - EmphasisMarker: é‡è¦å†…å®¹åŠ ç²—
  
  **CLIå‘½ä»¤**:
  ```bash
  # å¤„ç†æ‰€æœ‰VERIFIEDæ–‡æ¡£
  python -m src.cli.manage process postprocess --all
  
  # å¤„ç†å•ä¸ªæ–‡æ¡£
  python -m src.cli.manage process postprocess --doc-id <document_id>
  
  # åªæ‰§è¡Œç‰¹å®šæ­¥éª¤
  python -m src.cli.manage process postprocess --all --steps footnote,noise
  ```
  
  - ä¾èµ–: T019ï¼ˆå®¡æ ¸å‘˜CLIï¼‰
  - å·¥ä½œé‡: 3å¤© + 6å¤©ï¼ˆå¢å¼ºæ¨¡å—ï¼‰= 9å¤©

### é˜¶æ®µ5Bï¼šå‘é‡åŒ–ä¸ç´¢å¼•

- [x] T021 [US1] å®ç° `src/indexing/embedding/bge.py` åŒ…è£…å™¨ç”¨äº `BAAI/bge-small-zh-v1.5`
  - æ”¯æŒæ‰¹é‡embeddingç”Ÿæˆ (512ç»´å‘é‡)
  - æœ¬åœ°æ¨¡å‹åŠ è½½å’Œæ¨ç†
  - é›¶æˆæœ¬,å®Œå…¨å¼€æº
  
- [x] T022 [US1] å®ç° `src/indexing/vector_store/chroma.py` ç”¨äºä¿å­˜/æŸ¥è¯¢åµŒå…¥
  - ChromaDB collectionåˆå§‹åŒ–
  - æ”¯æŒmetadataè¿‡æ»¤æŸ¥è¯¢
  
- [x] T022a [US1] **[P0]** å®ç°æ··åˆæ£€ç´¢ (`src/indexing/vector_store/hybrid_retriever.py`)
  - BM25Index: å…³é”®è¯æ£€ç´¢ç´¢å¼•ï¼ˆä½¿ç”¨rank-bm25 + jiebaåˆ†è¯ï¼‰
  - HybridRetriever: æ··åˆæ£€ç´¢å™¨ï¼ˆDense Vector + BM25ï¼‰
  - RRFç®—æ³•: Reciprocal Rank Fusionèåˆ
  - æƒé‡è‡ªåŠ¨è°ƒæ•´: æ•°å­—æŸ¥è¯¢80% BM25ï¼Œé—®å¥80%è¯­ä¹‰
  - CLIå‘½ä»¤: `python -m src.cli.manage index --rebuild --enable-bm25`
  - ä¾èµ–: T022ï¼ˆChromaDBï¼‰
  - å·¥ä½œé‡: 5å¤©
  
- [x] T023 [US1] å®ç° `src/indexing/indexer.py` ä»¥åˆ†å— VERIFIED Markdown æ–‡ä»¶å¹¶ä¿å­˜åˆ° ChromaDB
  - ä½¿ç”¨MarkdownHeaderTextSplitteræŒ‰L1/L2/L3åˆ‡åˆ†
  - **é‡å é…ç½®**: `chunk_overlap=150` (çº¦20%çš„750 tokenså¹³å‡å¤§å°)
  - **è°ƒç”¨T023bçš„MetadataExtractorè‡ªåŠ¨å¡«å……metadata**
  - ç”ŸæˆPolicyChunk with metadataï¼ˆsection_id, categoryç­‰ï¼‰
  
- [x] T023b [US1] **[æ–°å¢]** å®ç°å…ƒæ•°æ®æå–å™¨ (`src/indexing/metadata_extractor.py`)
  - **MetadataExtractorç±»**:
    - `classify_category(content: str) -> ClauseCategory`: æ¡æ¬¾ç±»å‹åˆ†ç±»
    - `identify_entity_role(content: str) -> Optional[EntityRole]`: ä¸»ä½“è§’è‰²è¯†åˆ«
    - `extract_keywords(content: str, top_k: int = 5) -> List[str]`: å…³é”®è¯æå–
    - `extract_section_id(heading: str) -> Optional[str]`: ä»æ ‡é¢˜æå–æ¡æ¬¾ç¼–å·
    - `detect_parent_section(section_id: str) -> Optional[str]`: è®¡ç®—çˆ¶çº§ç« èŠ‚
  
  - **å…³é”®è¯æå–æ–¹æ³•**:
    - ä½¿ç”¨jiebaåˆ†è¯
    - TF-IDFç®—æ³•æå–Top-Kå…³é”®è¯
    - è¿‡æ»¤åœç”¨è¯ï¼ˆ"çš„"ã€"æ˜¯"ã€"åœ¨"ç­‰ï¼‰
    - ä¼˜å…ˆæå–ä¸“æœ‰åè¯ï¼ˆ"è¢«ä¿é™©äºº"ã€"å—ç›Šäºº"ç­‰ï¼‰
  
  - **å•å…ƒæµ‹è¯•**:
    - æµ‹è¯•å„ç±»æ¡æ¬¾çš„åˆ†ç±»å‡†ç¡®æ€§
    - æµ‹è¯•entity_roleè¯†åˆ«å‡†ç¡®æ€§
    - æµ‹è¯•å…³é”®è¯æå–ç›¸å…³æ€§
  
  - **é›†æˆ**: åœ¨T023 Indexerä¸­è°ƒç”¨MetadataExtractor
  
  - ä¾èµ–: jieba, sklearnï¼ˆTF-IDFï¼‰
  - å·¥ä½œé‡: 2å¤©

- [ ] T023c [US1] MetadataExtractor å•å…ƒæµ‹è¯•å®Œå–„
  - è¦†ç›–è¾¹ç•Œæƒ…å†µï¼šæ··åˆæ®µè½ã€æ•°å­—æ¡æ¬¾å·ã€è¡¨æ ¼ä¸Šä¸‹æ–‡
  - å¼•å…¥å°å‹åŸºå‡†é›†è¿›è¡Œå›å½’æµ‹è¯•

- [x] T023a [US1] **[P0]** è¡¨æ ¼ç‹¬ç«‹Chunkå¤„ç† (`src/indexing/chunker.py`)
  - SemanticChunker: è¯­ä¹‰æ„ŸçŸ¥åˆ‡åˆ†å™¨
  - è¡¨æ ¼è¯†åˆ«å¹¶ä½œä¸ºç‹¬ç«‹chunkæå–
  - è¡¨æ ¼JSONè½¬æ¢ï¼ˆheaders + rowsï¼‰
  - è¡¨æ ¼ä¸Šä¸‹æ–‡ä¿ç•™ï¼ˆå‰3è¡Œä½œä¸ºä¸Šä¸‹æ–‡ï¼‰
  - ä¸æ–‡æœ¬chunkåˆå¹¶å¹¶æŒ‰é¡ºåºæ’åˆ—
  - ä¾èµ–: T020aï¼ˆåå¤„ç†ï¼‰
  - å·¥ä½œé‡: 4å¤©
  
- [x] T024 [US1] å‘ `src/cli/manage.py` æ·»åŠ  `index` å‘½ä»¤
  - `index --rebuild`: é‡å»ºæ‰€æœ‰ç´¢å¼•
  - `index test-search "<query>"`: æµ‹è¯•æ£€ç´¢
  - `index stats`: æ˜¾ç¤ºç´¢å¼•ç»Ÿè®¡ä¿¡æ¯

### é˜¶æ®µ5Cï¼šMCPæœåŠ¡å™¨ä¸å·¥å…·

- [x] T025a [US1] **[P0]** é‡æ–°è®¾è®¡MCPå·¥å…·ï¼ˆ3ä¸ªä¸“ä¸šå·¥å…·ï¼‰
  - `search_policy_clause`: è¯­ä¹‰æ¡æ¬¾æ£€ç´¢
    - æ”¯æŒcompany/product/categoryè¿‡æ»¤
    - ç›¸ä¼¼åº¦é˜ˆå€¼ > 0.7
    - è¿”å›ClauseResult with SourceRef
  - `check_exclusion_risk`: å…è´£æ¡æ¬¾æ ¸æŸ¥
    - å¼ºåˆ¶è¿‡æ»¤category="Exclusion"
    - å…³é”®è¯æ‰©å±•ï¼ˆå¦‚"é…’é©¾" â†’ ["é…’åé©¾é©¶", "é¥®é…’", "é†‰é…’"]ï¼‰
    - å…è´£å£°æ˜å¿…é¡»è¿”å›
  - `calculate_surrender_value_logic`: é€€ä¿/å‡é¢äº¤æ¸…é€»è¾‘æå–
    - åŒæ—¶è¿”å›é€€ä¿å’Œå‡é¢äº¤æ¸…æ¡æ¬¾
    - å…³è”ç›¸å…³è¡¨æ ¼ï¼ˆç°é‡‘ä»·å€¼è¡¨ã€å‡é¢äº¤æ¸…è¡¨ï¼‰
    - ç”Ÿæˆå¯¹æ¯”è¯´æ˜
  - æ–‡ä»¶: `src/mcp_server/tools/{search_clause,check_exclusion,surrender_logic}.py`
  - ä¾èµ–: T022aï¼ˆæ··åˆæ£€ç´¢ï¼‰, T023aï¼ˆè¡¨æ ¼å¤„ç†ï¼‰
  - å·¥ä½œé‡: 5å¤©
  
- [x] T027 [US1] ä½¿ç”¨ `mcp` SDK å®ç° `src/mcp_server/server.py` å…¥å£ç‚¹
  - æ³¨å†Œ3ä¸ªMCPå·¥å…·
  - list_tools() å’Œ call_tool() å®ç°
  - é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### é˜¶æ®µ5Dï¼šæµ‹è¯•ä¸éªŒè¯

- [x] T028a [US1] **[P0]** é»„é‡‘æµ‹è¯•é›†æ„å»º (`tests/golden_dataset/`)
  - **MVPé˜¶æ®µ (å·²å®Œæˆ)**: 6ä¸ªä»£è¡¨æ€§æµ‹è¯•ç”¨ä¾‹
    - åŸºç¡€æŸ¥è¯¢: 3ä¸ª (èº«æ•…ä¿é™©é‡‘ã€æ»¡æœŸç”Ÿå­˜é‡‘ã€ç°é‡‘ä»·å€¼)
    - å¯¹æ¯”æŸ¥è¯¢: 1ä¸ª (èº«æ•…vsæ»¡æœŸ)
    - å…è´£æŸ¥è¯¢: 2ä¸ª (é…’é©¾ã€å…è´£æ€»è§ˆ)
    - æ–‡ä»¶: `phase5_test_set_v1.json`
  - **å®Œæ•´ç‰ˆæ‰©å±•è®¡åˆ’ (å¾…å®æ–½)**: 
    - **ç›®æ ‡**: æ‰©å±•è‡³50ä¸ªæ ‡å‡†é—®é¢˜ï¼Œç¬¦åˆSC-003æˆåŠŸæ ‡å‡†è¦æ±‚
    - **é—®é¢˜åˆ†å¸ƒ**: åŸºç¡€æŸ¥è¯¢20ä¸ª + å¯¹æ¯”æŸ¥è¯¢15ä¸ª + ä¸“é¡¹æ£€ç´¢15ä¸ª
    - **éªŒæ”¶æ ‡å‡†**:
      - åŸºç¡€æŸ¥è¯¢æµ‹è¯•: Top-1å‡†ç¡®ç‡ â‰¥ 90%
      - å¯¹æ¯”æŸ¥è¯¢æµ‹è¯•: Top-3ç»“æœä¸­åŒ…å«æ‰€æœ‰ç›¸å…³æ¡æ¬¾çš„æ¯”ä¾‹ â‰¥ 85%
      - ä¸“é¡¹æ£€ç´¢æµ‹è¯•: å…è´£æ¡æ¬¾å¬å›ç‡ â‰¥ 95%ï¼Œç²¾ç¡®ç‡ â‰¥ 90%
    - **å®æ–½æ­¥éª¤**:
      1. äººå·¥æ ‡æ³¨50ä¸ªé—®é¢˜çš„Ground Truthï¼ˆæ¯ä¸ªé—®é¢˜å¯¹åº”çš„æ‰€æœ‰ç›¸å…³å…è´£æ¡æ¬¾section_idï¼‰
      2. æ›´æ–°æµ‹è¯•æ•°æ®é›†æ–‡ä»¶ï¼ˆ`phase5_test_set_labeled.json`ï¼‰
      3. æ‰©å±•è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œæ”¯æŒ50ä¸ªé—®é¢˜çš„æ‰¹é‡è¯„ä¼°
      4. ä½¿ç”¨MRRå’ŒNDCG@kæŒ‡æ ‡è¿›è¡Œæ€§èƒ½è¯„ä¼°
      5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œè®°å½•å¤±è´¥æ¡ˆä¾‹ç”¨äºä¼˜åŒ–
    - **æ—¶é—´çº¿**: å»ºè®®åœ¨ç³»ç»Ÿç¨³å®šè¿è¡Œåï¼Œæœ‰è¶³å¤ŸçœŸå®æ•°æ®æ—¶è¿›è¡Œæ‰©å±•ï¼ˆé¢„è®¡2-3ä¸ªå·¥ä½œæ—¥ï¼‰
    - **ä¾èµ–**: T025aï¼ˆMCPå·¥å…·ï¼‰ã€T031ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰
  - ä¾èµ–: T025aï¼ˆMCPå·¥å…·ï¼‰
  - å·¥ä½œé‡: MVP 1å¤© (å·²å®Œæˆ) + å®Œæ•´ç‰ˆæ‰©å±• 2-3å¤© (å¾…å®æ–½)

- [ ] T028b [US1] **[P1]** å®Œæ•´ç‰ˆé»„é‡‘æµ‹è¯•é›†æ‰©å±• (50é¢˜)
  - ç›®æ ‡: æ‰©å±•è‡³50ä¸ªæ ‡å‡†é—®é¢˜ (åŸºç¡€20 + å¯¹æ¯”15 + ä¸“é¡¹15)
  - æ­¥éª¤: äººå·¥æ ‡æ³¨Ground Truth -> æ›´æ–°æµ‹è¯•é›†æ–‡ä»¶ -> æ‰©å±•è‡ªåŠ¨åŒ–æµ‹è¯• -> ç”ŸæˆæŠ¥å‘Š
  - ä¾èµ–: T028a

### é˜¶æ®µ5E: P0å¢å¼º - äº§å“èŒƒå›´æ£€ç´¢

- [X] T032 [FR-001 å¢å¼º] **[P0]** å¢å¼ºPolicyChunkæ•°æ®æ¨¡å‹
  - âœ… PolicyChunkå·²åŒ…å«äº§å“ä¸Šä¸‹æ–‡å­—æ®µ: `company`, `product_code`, `product_name`
  - âœ… `to_chroma_metadata`å’Œ`from_chroma_result`å·²æ”¯æŒæ–°å­—æ®µ
  - çŠ¶æ€: ä»£ç å®¡æŸ¥å‘ç°å·²å®ç°ï¼Œæ— éœ€ä¿®æ”¹

- [X] T033 [FR-001 å¢å¼º] **[P0]** æ›´æ–°ç´¢å¼•æµç¨‹ä¿å­˜äº§å“å…ƒæ•°æ®
  - âœ… `PolicyIndexer.index_document`å·²ä»Productè·å–ä¿¡æ¯å¹¶ä¼ é€’ç»™chunks
  - âœ… `ChromaDBStore.add_chunks`å·²ä¿å­˜äº§å“å…ƒæ•°æ®
  - âœ… `ChromaDBStore.search`å·²æ”¯æŒwhereè¿‡æ»¤
  - çŠ¶æ€: ä»£ç å®¡æŸ¥å‘ç°å·²å®ç°ï¼Œæ— éœ€ä¿®æ”¹

- [ ] T034 [FR-001 å¢å¼º] **[P0]** é‡å»ºç´¢å¼•
  - æ¸…ç©ºç°æœ‰ChromaDB collection
  - é‡æ–°ç´¢å¼•æ‰€æœ‰VERIFIEDæ–‡æ¡£ï¼ˆ44ä¸ªï¼‰
  - éªŒè¯äº§å“å…ƒæ•°æ®æ­£ç¡®ä¿å­˜
  - **æ‰§è¡Œå‘½ä»¤**: `python -m src.cli.manage index rebuild --use-docling --reset`
  - **çŠ¶æ€**: å¾…æ‰‹åŠ¨æ‰§è¡Œï¼ˆå»ºè®®åœ¨æœ‰çœŸå®æ•°æ®éœ€æ±‚æ—¶è¿›è¡Œï¼‰
  - å·¥ä½œé‡: 30åˆ†é’Ÿ

- [X] T035 [FR-001 å¢å¼º] **[P0]** å¢å¼ºMCPå·¥å…·æ”¯æŒäº§å“è¿‡æ»¤
  - âœ… `search_policy_clause`å·²æ”¯æŒ`company`ã€`product_code`ã€`doc_type`å‚æ•°
  - âœ… `check_exclusion_risk`å¯é€šè¿‡åº•å±‚æ£€ç´¢æ”¯æŒäº§å“è¿‡æ»¤
  - âœ… `calculate_surrender_value_logic`å¯é€šè¿‡åº•å±‚æ£€ç´¢æ”¯æŒäº§å“è¿‡æ»¤
  - çŠ¶æ€: ä»£ç å®¡æŸ¥å‘ç°å·²å®ç°ï¼Œæ— éœ€ä¿®æ”¹

- [X] T036 [FR-001 å¢å¼º] **[P0]** æµ‹è¯•éªŒè¯
  - âœ… åˆ›å»ºé›†æˆæµ‹è¯• `tests/integration/test_product_scoped_search.py`
  - âœ… åŒ…å«äº§å“æŸ¥è¯¢ã€äº§å“èŒƒå›´æ£€ç´¢ã€ç«¯åˆ°ç«¯æµ‹è¯•
  - çŠ¶æ€: æµ‹è¯•æ–‡ä»¶å·²åˆ›å»ºï¼Œå¾…è¿è¡ŒéªŒè¯

- [X] T037 [FR-001a] **[P0+]** å®ç°äº§å“æŸ¥è¯¢å·¥å…·
  - âœ… `src/mcp_server/product_lookup.py`å·²å­˜åœ¨å¹¶å®ç°å®Œæ•´åŠŸèƒ½
  - âœ… æ”¯æŒæ¨¡ç³ŠåŒ¹é…ã€æŒ‰å…¬å¸è¿‡æ»¤ã€Top-Kè¿”å›
  - âœ… åœ¨MCPæœåŠ¡å™¨ä¸­æ³¨å†Œä¸º`lookup_product`å·¥å…·
  - çŠ¶æ€: å·²å®Œæˆå¹¶é›†æˆåˆ°MCPæœåŠ¡å™¨
  
### é˜¶æ®µ5F: å¤šæ–‡æ¡£ç±»å‹æ”¯æŒ (FR-005)

**ç›®æ ‡**: æ”¯æŒå¤„ç†å’Œæ£€ç´¢3ç§æ–‡æ¡£ç±»å‹(æ¡æ¬¾/è¯´æ˜ä¹¦/è´¹ç‡è¡¨)

- [x] T038 [FR-005] **[P1]** æ•°æ®æ¨¡å‹æ›´æ–°
  - PolicyDocument.doc_typeæ”¹ä¸ºæšä¸¾ç±»å‹
  - PolicyChunkæ·»åŠ doc_typeå­—æ®µ
  - æ•°æ®åº“schemaæ›´æ–°
  - å·¥ä½œé‡: 30åˆ†é’Ÿ

- [x] T039 [FR-005] **[P1]** çˆ¬è™«é‡‡é›†éªŒè¯
  - éªŒè¯çˆ¬è™«æ˜¯å¦æ­£ç¡®è¯†åˆ«3ç§æ–‡æ¡£
  - ç¡®ä¿pdf_linksåŒ…å«æ‰€æœ‰ç±»å‹
  - æ›´æ–°ä¸‹è½½é€»è¾‘æ”¯æŒ3ç§æ–‡æ¡£
  - å·¥ä½œé‡: 30åˆ†é’Ÿ

- [x] T040 [FR-005] **[P1]** PDFè§£æç­–ç•¥ä¼˜åŒ–
  - æ·»åŠ äº§å“è´¹ç‡è¡¨è§£ææ”¯æŒ
  - ä¼˜åŒ–ä¸åŒç±»å‹çš„è§£æç­–ç•¥
  - æ›´æ–°converter.py
  - å·¥ä½œé‡: 1.5å°æ—¶

- [x] T041 [FR-005] **[P1]** ç´¢å¼•å’Œæ£€ç´¢æ›´æ–°
  - Chunkæ·»åŠ doc_typeå­—æ®µ
  - ChromaDB metadataåŒ…å«doc_type
  - MCPå·¥å…·æ·»åŠ å¯é€‰doc_typeå‚æ•°
  - é‡å»ºç´¢å¼•
  - å·¥ä½œé‡: 1å°æ—¶

- [x] T031 [US1] **[âœ… å·²å®Œæˆ]** ç«¯åˆ°ç«¯é›†æˆæµ‹è¯• `tests/integration/test_end_to_end.py`
  - **å®ç°æ—¶é—´**: 2025-11-24
  - **æµ‹è¯•ç­–ç•¥**: ä½¿ç”¨çœŸå®PDFæ•°æ®å’Œå·²æ„å»ºçš„ç´¢å¼•è¿›è¡ŒéªŒè¯
  - **æµ‹è¯•æµç¨‹**:
    1. éªŒè¯æ–‡æ¡£å·²ç´¢å¼• âœ…
    2. è¿æ¥ChromaDBï¼ˆ795 chunksï¼Œ512ç»´å‘é‡ï¼‰ âœ…
    3. æµ‹è¯•è¯­ä¹‰æ£€ç´¢ï¼ˆBGE Embeddingï¼‰ âœ…
    4. æµ‹è¯•æ··åˆæ£€ç´¢ï¼ˆDense + BM25 + RRFï¼‰ âœ…
    5. éªŒè¯å…ƒæ•°æ®å®Œæ•´æ€§ï¼ˆcompany, product_code, categoryï¼‰ âœ…
  - **æµ‹è¯•ç»“æœ**:
    - æµ‹è¯•æ•°æ®: å¹³å®‰ç¦è€€å¹´é‡‘ä¿é™©ï¼ˆå¹³å®‰äººå¯¿ï¼‰
    - Top-1ç›¸ä¼¼åº¦: 0.5922 (59.22%)
    - Top-1ç« èŠ‚: èº«æ•…ä¿é™©é‡‘ (Liability)
    - æ··åˆæ£€ç´¢: æˆåŠŸè¿”å›5ä¸ªç»“æœ
    - æ€§èƒ½: æŸ¥è¯¢å“åº” < 5ç§’ï¼ˆåŒ…å«BGEæ¨¡å‹åŠ è½½ï¼‰
  - **æ”¹è¿›è®°å½•**:
    - ä¿®å¤BM25æ··åˆæ£€ç´¢æŒä¹…åŒ–é—®é¢˜ï¼Œæ·»åŠ `config.BM25_INDEX_PATH`é…ç½®
    - ä¿®å¤9ä¸ªPydantic V2å¼ƒç”¨è­¦å‘Šï¼Œè¿ç§»è‡³ConfigDict
    - ä½¿ç”¨çœŸå®PDFæ•°æ®æ›¿ä»£Mockæ•°æ®ï¼Œæå‡æµ‹è¯•çœŸå®æ€§

### é˜¶æ®µ5G: æ™ºèƒ½æ–‡æ¡£ç±»å‹æ¨æ–­ (FR-012)

**ç›®æ ‡**: åœ¨MCPæœåŠ¡å™¨ç«¯å®ç°æ™ºèƒ½æ–‡æ¡£ç±»å‹æ¨æ–­ï¼Œæ ¹æ®æŸ¥è¯¢å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ–‡æ¡£ç±»å‹

- [x] T059 [FR-012] **[P1]** å®ç°æ™ºèƒ½doc_typeæ¨æ–­é€»è¾‘ (`src/mcp_server/tools/search_policy_clause.py`)
  - **å®ç°`_infer_doc_type()`æ–¹æ³•**:
    - è´¹ç‡è¡¨æ¨æ–­ï¼šåŒ…å«"ä¿è´¹"ã€"è´¹ç‡"ç­‰å…³é”®è¯ + æ•°å­— â†’ "äº§å“è´¹ç‡è¡¨"
    - è´¹ç‡è¡¨æ¨æ–­ï¼šåŒ…å«"ä¿è´¹"ã€"è´¹ç‡"ç­‰å…³é”®è¯ + æ•°å­— â†’ "äº§å“è´¹ç‡è¡¨"
    - å…¶ä»–æƒ…å†µï¼šè¿”å›Noneï¼ˆæŸ¥è¯¢æ‰€æœ‰ç±»å‹ï¼‰ï¼Œä¾èµ–è¯­ä¹‰æ£€ç´¢è‡ªåŠ¨åŒ¹é…
  - **é›†æˆåˆ°`run()`æ–¹æ³•**:
    - å¦‚æœå®¢æˆ·ç«¯æœªæŒ‡å®š`doc_type`ï¼Œåˆ™è°ƒç”¨`_infer_doc_type()`è¿›è¡Œæ¨æ–­
    - è®°å½•æ¨æ–­ç»“æœåˆ°æ—¥å¿—
  - **å•å…ƒæµ‹è¯•**:
    - æµ‹è¯•å„ç§æŸ¥è¯¢åœºæ™¯çš„æ¨æ–­å‡†ç¡®æ€§
    - éªŒè¯æ¨æ–­å‡†ç¡®ç‡ â‰¥ 80%
  - ä¾èµ–: T041ï¼ˆMCPå·¥å…·doc_typeå‚æ•°æ”¯æŒï¼‰
  - å·¥ä½œé‡: 1å¤©

- [x] T060 [FR-012] **[P1]** æ›´æ–°æµ‹è¯•è¯„ä¼°é€»è¾‘
  - åœ¨`TestCaseResult`ä¸­æ·»åŠ `doc_type_distribution`å­—æ®µ
  - åœ¨`_evaluate_case()`ä¸­ç»Ÿè®¡è¿”å›ç»“æœçš„`doc_type`åˆ†å¸ƒ
  - åœ¨æµ‹è¯•æŠ¥å‘Šä¸­æ˜¾ç¤º`doc_type`åˆ†å¸ƒæƒ…å†µ
  - ä¾èµ–: T059ï¼ˆæ™ºèƒ½æ¨æ–­å®ç°ï¼‰
  - å·¥ä½œé‡: 0.5å¤©

- [x] T061 [FR-013] **[P1]** æ‰©å±•ClauseResultç»“æ„
  - åœ¨`src/common/models.py`ä¸­ä¸º`ClauseResult`æ·»åŠ å­—æ®µï¼š
    - `table_refs: List[str]` - å…³è”çš„è´¹ç‡è¡¨UUIDåˆ—è¡¨
    - `doc_type: str` - æ–‡æ¡£ç±»å‹
  - æ›´æ–°`src/mcp_server/tools/search_policy_clause.py`ï¼š
    - åœ¨æ„å»ºClauseResultæ—¶ä»metadataæå–`table_refs`å’Œ`doc_type`
    - å¤„ç†`table_refs`çš„åºåˆ—åŒ–æ ¼å¼ï¼ˆé€—å·åˆ†éš”å­—ç¬¦ä¸²ï¼‰
  - æ›´æ–°`SourceRef`çš„`document_type`å­—æ®µè¯´æ˜ï¼ŒåŒ…å«"äº§å“è´¹ç‡è¡¨"
  - å•å…ƒæµ‹è¯•ï¼šéªŒè¯æ–°å­—æ®µæ­£ç¡®å¡«å……
  - ä¾èµ–: T041ï¼ˆMCPå·¥å…·doc_typeæ”¯æŒï¼‰
  - å·¥ä½œé‡: 0.5å¤©

- [x] T062 [FR-013] **[P1]** å®ç°è´¹ç‡è¡¨è®¿é—®å·¥å…· (`get_rate_table`)
  - åˆ›å»º`src/mcp_server/tools/get_rate_table.py`
  - å®ç°`GetRateTableTool`ç±»ï¼š
    - ä»`assets/tables/metadata.json`è¯»å–å…ƒæ•°æ®
    - ä»`assets/tables/{table_id}.csv`è¯»å–CSVæ•°æ®
    - æ”¯æŒç®€å•çš„è¡Œè¿‡æ»¤ï¼ˆå¦‚å¹´é¾„=30ï¼‰
    - è¿”å›`RateTableData`å¯¹è±¡
  - åœ¨MCPæœåŠ¡å™¨ä¸­æ³¨å†Œ`get_rate_table`å·¥å…·
  - å•å…ƒæµ‹è¯•ï¼šæµ‹è¯•CSVè¯»å–å’Œè¿‡æ»¤åŠŸèƒ½
  - é›†æˆæµ‹è¯•ï¼šç«¯åˆ°ç«¯æµ‹è¯•è´¹ç‡è¡¨æŸ¥è¯¢æµç¨‹
  - ä¾èµ–: T061ï¼ˆClauseResultæ‰©å±•ï¼‰
  - å·¥ä½œé‡: 1å¤©

## ç¬¬å…­é˜¶æ®µï¼šDocling é›†æˆä¸ç»“æ„åŒ–è§£æé‡æ„ (Phase 6: Docling Integration)

**ç›®æ ‡**: å‡çº§è§£æå¼•æ“ï¼Œè§£å†³å¤šæ æ’ç‰ˆå’Œè¡¨æ ¼ç»“æ„é—®é¢˜ï¼Œä¸ºè´¹ç‡æŸ¥è¯¢æ‰“åŸºç¡€ã€‚

### Stage 6A: åŸºç¡€æ¶æ„ä¸ä¾èµ–
- [x] T042 å®‰è£… Docling ä¾èµ–å¹¶é…ç½®ç¯å¢ƒ (`pip install docling`)
- [x] T043 åˆ›å»ºæ–°çš„ç´¢å¼•ç›®å½•ç»“æ„ (`src/indexing/{parsers,analyzers,chunkers}`) å’Œèµ„æºç›®å½• (`assets/tables`)
- [x] T044 æ›´æ–° `config.py` æ·»åŠ  Docling ç›¸å…³é…ç½® (`DOCLING_MODEL_PATH`, `TABLE_EXPORT_DIR`)

### Stage 6B: è§£æå™¨å®ç°
- [x] T045 å®ç° `src/indexing/parsers/docling_parser.py`ï¼Œå°è£… Docling API
- [x] T046 éªŒè¯åŒæ  PDF çš„é˜…è¯»é¡ºåºæ¢å¤æ•ˆæœ (>=98% å‡†ç¡®ç‡)
  - æ³¨ï¼šDocling å†…ç½®ç‰ˆé¢åˆ†æèƒ½åŠ›ï¼Œè‡ªåŠ¨å¤„ç†å¤šæ æ’ç‰ˆ

### Stage 6C: è´¹ç‡è¡¨åˆ†ç¦»
- [x] T047 å®ç° `src/indexing/analyzers/table_classifier.py`ï¼Œè¯†åˆ«è´¹ç‡è¡¨ vs æ™®é€šè¡¨
- [x] T048 å®ç°è¡¨æ ¼åºåˆ—åŒ–é€»è¾‘ï¼Œå°†è´¹ç‡è¡¨å¯¼å‡ºä¸º CSV/JSON åˆ° `assets/tables/`
- [x] T049 å®ç°å…ƒæ•°æ®è®°å½•ï¼Œåœ¨ `metadata.json` ä¸­ç»´æŠ¤è¡¨ä¸æºæ–‡ä»¶çš„å…³ç³»

### Stage 6D: æ™ºèƒ½åˆ‡ç‰‡ä¸ç´¢å¼•é‡æ„
- [x] T050 å®ç° `src/indexing/chunkers/markdown_chunker.py`ï¼Œæ”¯æŒ Markdown æ ‡é¢˜å±‚çº§åˆ‡åˆ†å’Œé¢åŒ…å±‘è·¯å¾„æ³¨å…¥
  - æ”¯æŒ 1-5 çº§æ ‡é¢˜è§£æ
  - Breadcrumb è·¯å¾„æ ¼å¼: `[ç« èŠ‚: ä¿é™©è´£ä»» > é‡ç–¾ > ç»™ä»˜æ¡ä»¶]`
  - Token ä¼°è®¡: 1 token â‰ˆ 1.5 ä¸­æ–‡å­—ç¬¦
  - Chunk é‡å : ä¿ç•™ä¸Šä¸€ä¸ªæ®µè½ï¼ˆç›®æ ‡ 128 token é‡å ï¼‰
- [x] T051 æ›´æ–° `PolicyChunk` æ¨¡å‹ï¼Œæ·»åŠ  `section_path` å’Œ `table_refs` å­—æ®µ
  - `section_path: Optional[str]` - ç« èŠ‚é¢åŒ…å±‘è·¯å¾„
  - `table_refs: List[str]` - è´¹ç‡è¡¨ UUID åˆ—è¡¨
  - `to_chroma_metadata()` å’Œ `from_chroma_result()` å·²æ”¯æŒåºåˆ—åŒ–
- [x] T052 é‡æ„ `src/indexing/indexer.py`ï¼Œé›†æˆ DoclingParser å’Œæ–°çš„ Chunking ç­–ç•¥
  - **Docling æ¨¡å¼** (`use_docling=True`): PDF â†’ DoclingParser â†’ è´¹ç‡è¡¨åˆ†ç¦» â†’ MarkdownChunker
  - **Legacy æ¨¡å¼** (`use_docling=False`): Markdown â†’ MarkdownChunker
  - è´¹ç‡è¡¨å¯¼å‡º: TableClassifier + TableSerializer â†’ CSV + metadata.json
  - æ™®é€šè¡¨æ ¼: è½¬ Markdown è¡¨æ ¼ä¿ç•™åœ¨æ–‡æ¡£ä¸­
  - å¡«å…… `section_path` å’Œ `table_refs` å­—æ®µ
  - å•å…ƒæµ‹è¯•: `tests/unit/test_policy_indexer.py` (7/7 é€šè¿‡)
- [x] T053 æ›´æ–° CLI å‘½ä»¤ `src/cli/manage.py`ï¼Œæ·»åŠ  `index rebuild --use-docling` å’Œ `tables` ç›¸å…³å‘½ä»¤
  - `index rebuild --use-docling/--no-docling`: æ”¯æŒDoclingå’ŒLegacyä¸¤ç§æ¨¡å¼åˆ‡æ¢
  - `index tables --list`: åˆ—å‡ºæ‰€æœ‰å¯¼å‡ºçš„è´¹ç‡è¡¨
  - `index tables --list --product <code>`: æŒ‰äº§å“ä»£ç è¿‡æ»¤
  - `index tables --show <uuid>`: æ˜¾ç¤ºè´¹ç‡è¡¨è¯¦æƒ…å’ŒCSVé¢„è§ˆ
  - ä½¿ç”¨ Rich Console ç¾åŒ–è¾“å‡º

### Stage 6E: æµ‹è¯•ä¸éªŒè¯
- [x] T054 ç¼–å†™å•å…ƒæµ‹è¯• (`test_docling_parser.py`) è¦†ç›–è§£æã€åˆ†ç±»å’Œåˆ‡ç‰‡é€»è¾‘
  - `tests/unit/test_docling_parser.py`: DoclingParser åŸºç¡€åŠŸèƒ½ (2/2 é€šè¿‡)
  - `tests/unit/test_policy_indexer.py`: PolicyIndexer é‡æ„éªŒè¯ (7/7 é€šè¿‡)
- [x] T055 ç¼–å†™é›†æˆæµ‹è¯• (`test_docling_indexing.py`) éªŒè¯ç«¯åˆ°ç«¯ç´¢å¼•æµç¨‹
  - è´¹ç‡è¡¨åˆ†ç±»å’Œå¯¼å‡ºæµ‹è¯• âœ…
  - MarkdownChunker å¤æ‚å±‚çº§æµ‹è¯• âœ…
  - Docling æ¨¡å¼ç«¯åˆ°ç«¯æµ‹è¯• âœ…
  - Legacy æ¨¡å¼ç«¯åˆ°ç«¯æµ‹è¯• âœ…
  - æ‰€æœ‰æµ‹è¯•é€šè¿‡ (4/4)
- [ ] T056 æ‰§è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯• (`benchmarks/docling_performance.py`)
  - å»ºè®®: åœ¨æœ‰çœŸå®æ•°æ®åè¿›è¡Œæ€§èƒ½æµ‹è¯•
  - å¯¹æ¯” Docling vs Legacy æ¨¡å¼çš„è§£æé€Ÿåº¦ã€å†…å­˜å ç”¨ã€å‡†ç¡®åº¦

## ç¬¬ä¸ƒé˜¶æ®µï¼šå®Œå–„ä¸è·¨é¢†åŸŸå…³æ³¨ç‚¹

**ç›®æ ‡**: æ–‡æ¡£å’Œæœ€ç»ˆæ¸…ç†ã€‚

- [x] T029 æ ¹æ® quickstart.md æ›´æ–° README.md çš„ä½¿ç”¨è¯´æ˜
  - æ›´æ–°å‘é‡æ£€ç´¢éƒ¨åˆ†ä¸º"å·²å®ç°"
  - æ·»åŠ MCPæœåŠ¡éƒ¨åˆ†
  - æ›´æ–°å¼€å‘æ—¥å¿—ï¼Œåæ˜ Phase 6å®Œæˆ
  - æ›´æ–°æ”¹è¿›è®¡åˆ’ï¼Œæ ‡è®°Doclingé›†æˆå®Œæˆ
- [ ] T030 éªŒè¯æ‰€æœ‰ CLI å‘½ä»¤è¾“å‡ºç”¨æˆ·å‹å¥½çš„æ—¥å¿—
  - å»ºè®®ï¼šåœ¨å®é™…ä½¿ç”¨ä¸­é€æ­¥ä¼˜åŒ–
- [x] T031 [US1] **[âœ… å·²å®Œæˆ]** æœ€ç»ˆç«¯åˆ°ç«¯æµ‹è¯•
  - **å®Œæˆæ—¶é—´**: 2025-11-25
  - **æµ‹è¯•èŒƒå›´**: çˆ¬å– -> å¤„ç† -> æ ¸éªŒ -> ç´¢å¼• -> æœç´¢ å…¨æµç¨‹
  - **æµ‹è¯•ç»“æœ**: 795 chunksç´¢å¼•ï¼ŒTop-1ç›¸ä¼¼åº¦0.5922ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡

## ç¬¬å…«é˜¶æ®µï¼šåˆè§„æ€§ä¸è´¨é‡ä¿è¯ (Phase 8: Compliance & QA)

**ç›®æ ‡**: å®Œå–„æµ‹è¯•è¦†ç›–ï¼Œæå‡ä»£ç è´¨é‡ã€‚

### å·²å®Œæˆä»»åŠ¡
- [x] T057 å®ç°çˆ¬è™«å®¡è®¡æ—¥å¿— (`src/crawler/middleware/audit_logger.py`)
  - **å®Œæˆæ—¶é—´**: 2025-11-25
  - **åŠŸèƒ½**: è®°å½•å‘ç°ã€ä¸‹è½½ã€å¤±è´¥ã€é‡è¯•ã€é™æµã€ç†”æ–­ã€robotsé˜»æ­¢ç­‰æ“ä½œ
  - **å­˜å‚¨**: SQLiteæŒä¹…åŒ–ï¼Œæ”¯æŒæŒ‰æ—¶é—´/å…¬å¸/äº§å“æŸ¥è¯¢
  - **æµ‹è¯•**: 21ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - **åˆè§„**: æ»¡è¶³Constitution 2.2æ¥æºå¯è¿½æº¯æ€§è¦æ±‚

### å¾…å®Œæˆä»»åŠ¡
- [x] T058 å®Œå–„MCPå·¥å…·BM25ç´¢å¼•åŠ è½½é€»è¾‘
  - å®ç°BM25ç´¢å¼•æ‡’åŠ è½½
  - ä¼˜é›…é™çº§ï¼ˆBM25ç¼ºå¤±æ—¶å›é€€çº¯è¯­ä¹‰æ£€ç´¢ï¼‰
- [x] T014b robots.txtåˆè§„æ€§æµ‹è¯•
  - å•å…ƒæµ‹è¯•ï¼šç¦æ­¢è®¿é—®è¢«robotsç¦æ­¢çš„è·¯å¾„
  - é›†æˆæµ‹è¯•ï¼šæ¨¡æ‹Ÿ429/403è§¦å‘ç†”æ–­
- [x] T023c å…ƒæ•°æ®æå–å™¨è¾¹ç•Œæµ‹è¯•
  - è¦†ç›–æ··åˆæ®µè½ã€æ•°å­—æ¡æ¬¾å·ã€è¡¨æ ¼ä¸Šä¸‹æ–‡è¾¹ç•Œæƒ…å†µ

## ä¾èµ–å…³ç³»

```mermaid
graph TD
    Setup(Phase 1: Setup) --> Foundation(Phase 2: Foundation)
    Foundation --> Crawler(Phase 3: Crawler / US3)
    Crawler --> Parser(Phase 4: Parser / US2)
    Parser --> Auditor(Phase 4: Auditor / US2)
    
    Auditor --> T020a[T020a: Markdownåå¤„ç†]
    T020a --> T021[T021: BGE Embedding]
    T020a --> T022a[T022a: æ··åˆæ£€ç´¢]
    T020a --> T023a[T023a: è¡¨æ ¼ç‹¬ç«‹Chunk]
    T020a --> T023b[T023b: å…ƒæ•°æ®æå–å™¨]
    
    T021 --> T022[T022: ChromaDB]
    T022a --> T023[T023: ç´¢å¼•å™¨]
    T022 --> T023
    T023a --> T023
    T023b --> T023
    
    T023 --> T025a[T025a: MCPå·¥å…·é‡è®¾è®¡]
    T022a --> T025a
    
    T025a --> T027[T027: MCP Server]
    T025a --> T028a[T028a: é»„é‡‘æµ‹è¯•é›†]
    
    T027 --> T031[T031: ç«¯åˆ°ç«¯æµ‹è¯•]
    T028a --> T031
    
    subgraph Phase6_Docling
    T042[T042: Doclingä¾èµ–] --> T045[T045: DoclingParser]
    T043[T043: ç›®å½•ç»“æ„] --> T045
    T045 --> T047[T047: è¡¨æ ¼åˆ†ç±»å™¨]
    T047 --> T048[T048: è´¹ç‡è¡¨å¯¼å‡º]
    T045 --> T050[T050: MarkdownChunker]
    T050 --> T052[T052: Indexeré‡æ„]
    T048 --> T052
    T051[T051: PolicyChunkæ›´æ–°] --> T052
    T052 --> T055[T055: é›†æˆæµ‹è¯•]
    end
    
    Crawler --> T042
```

**æ–°å¢ä»»åŠ¡è¯´æ˜**:
- â­ **T020a**: Markdownåå¤„ç†ï¼ˆè„šæ³¨å†…è”ã€å™ªéŸ³å»é™¤ã€ç»“æ„åŒ–å¢å¼ºï¼‰- 9å¤©
- â­ **T022a**: æ··åˆæ£€ç´¢ï¼ˆBM25 + Vector + RRFï¼‰- 5å¤©
- â­ **T023a**: è¡¨æ ¼ç‹¬ç«‹Chunkï¼ˆSemanticChunkerï¼‰- 4å¤©
- â­ **T023b**: å…ƒæ•°æ®æå–å™¨ï¼ˆcategoryåˆ†ç±»ã€entity_roleè¯†åˆ«ã€keywordsæå–ï¼‰- 2å¤©
- â­ **T025a**: MCPå·¥å…·é‡è®¾è®¡ï¼ˆ3ä¸ªä¸“ä¸šå·¥å…·ï¼‰- 5å¤©
- â­ **T028a**: é»„é‡‘æµ‹è¯•é›†ï¼ˆ50ä¸ªé—®é¢˜ï¼Œåˆ†å±‚æµ‹è¯•ï¼‰- 3å¤©

**ç¬¬äº”é˜¶æ®µæ€»å·¥ä½œé‡**: 15-20å·¥ä½œæ—¥ + 6å¤©ï¼ˆMarkdownå¢å¼ºï¼‰+ 2å¤©ï¼ˆå…ƒæ•°æ®æå–ï¼‰= 23-28å·¥ä½œæ—¥

