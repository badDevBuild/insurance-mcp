# Insurance-MCP 改进路线图

**文档版本**: 1.0  
**创建日期**: 2025-11-24  
**基于**: 深度研究报告《保险文档智能处理全流程架构》

---

## 📊 现状评估

### 当前系统架构 (As-Is)

```
PDF文件
  ↓
[基础PDF文本提取] → 简单字符流
  ↓
[基础切片 (固定长度)] → 可能切断句子
  ↓
[MetadataExtractor] → 元数据提取 (79%准确率)
  ↓
[BGE-Small-ZH] → 向量化
  ↓
[ChromaDB] → 存储 (12个元数据字段)
  ↓
[MCP工具] → search_policy_clause, lookup_product
```

### 核心问题 (Pain Points)

| 问题类型 | 严重程度 | 具体表现 | 影响 |
|---------|---------|---------|------|
| **解析质量** | 🔴 严重 | 多栏排版阅读顺序错乱，表格结构丢失 | 检索结果语义混乱，LLM理解错误 |
| **表格处理** | 🔴 严重 | 费率表被打碎为文本chunk，数字失去上下文 | 无法精确回答"45岁保费多少"类问题 |
| **上下文缺失** | 🟠 中等 | chunk不包含父级章节信息 | LLM不知道条款属于"保险责任"还是"免责" |
| **检索单一** | 🟠 中等 | 仅稠密向量检索 | 对"第2.1.4条"等精确查询效果差 |
| **推理能力** | 🟡 待定 | 单步工具调用 | 无法处理"对比A/B产品差异"等复杂问题 |

---

## 🎯 改进总体目标

遵循**"数据质量决定RAG上限"**原则，采用分阶段渐进式改进：

### 四阶段路线图

```
Phase 1 (当前)         Phase 2             Phase 3              Phase 4
高保真解析重构    →   领域知识增强    →   图谱与推理      →   多模态智能体
[3周]                 [3周]               [4周]               [6周]
```

**优先级原则**:
- Phase 1-2 为**必须完成** (夯实基础)
- Phase 3 为**应该完成** (提升能力)
- Phase 4 为**可选完成** (探索前沿)

---

## 📋 Phase 1: 高保真结构化解析重构 (CURRENT)

**目标**: 将"文本流提取"升级为"文档对象模型(DOM)提取"

**执行计划**: 见 `/plans/4ba969fd-cc33-428d-bb9a-e49b8c42c3da` (已创建)

### 核心技术选型

- **解析引擎**: Docling (IBM开源)
- **策略**: 费率表分离 + Markdown层级化切片
- **预期效果**:
  - 表格还原准确率 ≥95%
  - 阅读顺序准确率 ≥98%
  - 费率查询准确率 100%

### 关键交付物

1. `src/indexing/parsers/docling_parser.py` - 新解析器
2. `src/indexing/analyzers/table_classifier.py` - 表格分类器
3. `src/indexing/chunkers/markdown_chunker.py` - 层级切片器
4. `assets/tables/` - 费率表存储目录
5. `DOCLING_INTEGRATION.md` - 集成文档

**时间估算**: 11-14个工作日  
**状态**: 🟢 计划已批准，待执行

---

## 📋 Phase 2: 领域知识增强 (PLANNED)

**目标**: 提升向量检索精度，增加费率表查询能力

### 2.1 混合检索 (Hybrid Retrieval)

**问题**: 纯向量检索对精确匹配查询（如"第2.1.4条"）效果差

**方案**: 实施稠密向量 + 稀疏向量双路召回

**技术选型**:
- **嵌入模型升级**: BGE-M3 (支持多功能输出)
- **融合算法**: RRF (Reciprocal Rank Fusion)

**实施步骤**:
1. 升级到BGE-M3模型
2. 为每个chunk生成稠密+稀疏双向量
3. 在ChromaDB检索层实现RRF融合
4. A/B测试对比准确率提升

**预期效果**:
- 精确条款查询准确率 +30%
- 语义查询保持现有水平

---

### 2.2 费率表查询工具 (Text-to-SQL)

**问题**: 费率表虽然分离了，但还没有查询接口

**方案**: 实现结构化查询工具

**实施步骤**:
1. 将CSV费率表导入SQLite数据库
2. 构建Text-to-SQL Agent
3. 注册为新的MCP工具 `query_rate_table`

**示例用法**:
```python
# 用户查询: "45岁男性吸烟者，20年缴费的保费是多少？"
# Agent生成SQL:
SELECT premium FROM rate_tables 
WHERE age=45 AND gender='Male' AND smoker=TRUE AND payment_term='20Y'
```

**预期效果**:
- 数值查询零幻觉
- 支持复杂条件组合查询

---

### 2.3 领域模型微调 (可选)

**方案**: 基于FinMTEB基准，评估是否微调嵌入模型

**步骤**:
1. 收集100+保险查询-答案对作为评估集
2. 在通用BGE-M3上测试
3. 如果准确率<85%，考虑微调
4. 使用对比学习在保险语料上微调

**时间估算**: Phase 2总计 3周

---

## 📋 Phase 3: 图谱与推理 (FUTURE)

**目标**: 处理跨文档对比和全局性问题

### 3.1 知识图谱构建

**应用场景**:
- "对比A产品和B产品在重疾定义上的区别"
- "找出所有包含恐怖主义免责的条款"

**技术选型**:
- **图数据库**: Neo4j 或 LanceDB (支持向量+图)
- **本体设计**: 基于FIBO (金融行业本体)

**实体与关系**:
```
实体 (Nodes):
- Product (产品)
- Clause (条款)
- Risk (风险)
- Exclusion (免责)

关系 (Edges):
- HAS_CLAUSE (产品 → 条款)
- DEFINES (条款 → 风险)
- EXCLUDES (条款 → 免责)
- CONFLICTS_WITH (条款 ↔ 条款)
```

---

### 3.2 GraphRAG集成

**方案**: 采用微软GraphRAG框架

**工作流**:
1. LLM自动从文档提取实体和关系三元组
2. 构建知识图谱
3. 社区检测生成摘要
4. 查询时基于图遍历+向量检索

**优势**:
- 回答宏观问题的能力 (如"这份保险的主要风险点")
- 自动发现条款之间的隐含关系

**时间估算**: 4周

---

## 📋 Phase 4: 多模态智能体 (EXPLORATION)

**目标**: 从"文档检索"到"业务办理"

### 4.1 LangGraph编排

**应用场景**: 自动核保流程

**工作流设计**:
```
[用户提交核保请求]
  ↓
[Router: 判断需要哪些信息]
  ↓
  ├→ [查询健康告知条款] (Vector RAG)
  ├→ [查询年龄段费率] (Text-to-SQL)
  └→ [检查产品组合规则] (GraphRAG)
  ↓
[Critic: 信息是否足够?]
  ├─ 不足 → [生成追问] → 返回用户
  └─ 足够 → [生成核保结论]
  ↓
[人工审核断点] (HITL)
  ↓
[发送结果]
```

---

### 4.2 多模态扩展

**场景**: 处理理赔照片和手写单据

**技术**:
- GPT-4V / Claude 3.5 Sonnet (视觉理解)
- PaddleOCR (手写识别)

**时间估算**: 6周

---

## 📊 总体时间规划

| Phase | 工作量 | 累计时间 | 状态 |
|-------|--------|---------|------|
| Phase 1: 高保真解析 | 3周 | 3周 | 🟢 计划中 |
| Phase 2: 知识增强 | 3周 | 6周 | 🟡 待启动 |
| Phase 3: 图谱推理 | 4周 | 10周 | ⚪ 计划中 |
| Phase 4: 多模态智能体 | 6周 | 16周 | ⚪ 探索性 |

**最小可行产品 (MVP)**: Phase 1 + Phase 2.1 + Phase 2.2 (约6周)

---

## 🎯 成功指标 (KPIs)

### Phase 1 完成后
- [ ] 表格还原准确率 ≥95%
- [ ] 费率表与文本完全隔离
- [ ] Chunk包含完整章节路径

### Phase 2 完成后
- [ ] 精确条款查询准确率 +30%
- [ ] 费率数值查询零幻觉
- [ ] 支持10种以上复杂查询模式

### Phase 3 完成后
- [ ] 支持跨产品对比查询
- [ ] 全局性问题回答准确率 ≥80%

### Phase 4 完成后
- [ ] 端到端核保流程自动化率 ≥60%
- [ ] 支持图像+文本混合理赔

---

## 🚨 风险管理

### 技术风险
1. **Docling依赖问题** → 缓解: 保留旧解析器作为fallback
2. **性能下降** → 缓解: 批处理+GPU加速+缓存
3. **模型微调成本高** → 缓解: Phase 2.3标记为可选

### 资源风险
1. **时间不足** → 缓解: 优先完成Phase 1-2，Phase 3-4可延后
2. **GPU资源** → 缓解: 使用量化模型，或调用云端API

---

## 📚 参考资料

1. **深度研究报告**: 《保险文档智能处理全流程架构》
2. **Docling文档**: https://github.com/DS4SD/docling
3. **BGE-M3论文**: https://arxiv.org/abs/2402.03216
4. **GraphRAG论文**: https://arxiv.org/abs/2404.16130
5. **FinMTEB基准**: https://github.com/FlagOpen/FlagEmbedding/tree/master/FlagEmbedding/finemteb

---

## 📝 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2025-11-24 | 1.0 | 初始版本，基于研究报告制定4阶段路线图 | AI Assistant |

---

**下一步行动**: 执行 Phase 1 计划 (Plan ID: `4ba969fd-cc33-428d-bb9a-e49b8c42c3da`)
