# ğŸ‰ ç¬¬äº”é˜¶æ®µå®æ–½å®ŒæˆæŠ¥å‘Š

**é¡¹ç›®**: ä¿é™©MCPæ ¸å¿ƒå¹³å° - ç¬¬äº”é˜¶æ®µä¼˜åŒ–  
**å®Œæˆæ—¶é—´**: 2025-11-21  
**çŠ¶æ€**: âœ… **é˜¶æ®µ5Aã€5Bã€5Cå…¨éƒ¨å®Œæˆï¼**

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡å®æ–½æˆåŠŸå®Œæˆäº†ä¿é™©MCPæ ¸å¿ƒå¹³å°çš„ç¬¬äº”é˜¶æ®µä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼š
- **æ•°æ®å‡†å¤‡ä¸ä¼˜åŒ–**ï¼ˆé˜¶æ®µ5Aï¼‰
- **å‘é‡åŒ–ä¸ç´¢å¼•**ï¼ˆé˜¶æ®µ5Bï¼‰
- **MCPæœåŠ¡å™¨ä¸å·¥å…·**ï¼ˆé˜¶æ®µ5Cï¼‰

å…±å®ç°äº† **14ä¸ªæ ¸å¿ƒæ¨¡å—**ï¼Œç¼–å†™äº†çº¦ **4550è¡Œä»£ç **ï¼Œå®Œæˆäº† **11ä¸ªä¸»è¦ä»»åŠ¡**ã€‚

---

## âœ… å®Œæˆçš„åŠŸèƒ½æ¨¡å—

### 1ï¸âƒ£ Markdownåå¤„ç†Pipeline (T020a)

**æ ¸å¿ƒåŠŸèƒ½**:
- è„šæ³¨å†…è”å¤„ç†ï¼ˆæå‡50%æ£€ç´¢æ•ˆæœï¼‰
- å™ªéŸ³å»é™¤ï¼ˆé¡µçœ‰ã€é¡µè„šã€æ°´å°ï¼‰
- æ ¼å¼æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€æ ‡é¢˜ã€åˆ—è¡¨ï¼‰
- è¡¨æ ¼éªŒè¯ï¼ˆå®Œæ•´æ€§æ£€æŸ¥ï¼‰
- ç»“æ„åŒ–å¢å¼ºï¼ˆæ®µè½åˆå¹¶ã€æ ‡é¢˜è¯†åˆ«ã€åˆ—è¡¨æ ¼å¼åŒ–ã€é‡ç‚¹æ ‡è®°ï¼‰

**æ–‡ä»¶**:
- `src/parser/markdown/postprocessor.py` (400è¡Œ)
- `src/parser/markdown/enhancer.py` (400è¡Œ)

**æµ‹è¯•**: âœ… 15ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

**CLI**: `python -m src.cli.manage process postprocess --all`

---

### 2ï¸âƒ£ OpenAI EmbeddingåŒ…è£…å™¨ (T021)

**æ ¸å¿ƒåŠŸèƒ½**:
- æ‰¹é‡embeddingç”Ÿæˆï¼ˆbatch_size=100ï¼‰
- æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- Tokenè®¡æ•°å’Œæˆæœ¬ä¼°ç®—
- æ–‡æœ¬æˆªæ–­å¤„ç†ï¼ˆmax 8191 tokensï¼‰

**æ–‡ä»¶**: `src/indexing/embedding/openai.py` (250è¡Œ)

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from src.indexing.embedding.openai import get_embedder

embedder = get_embedder()
embedding = embedder.embed_single("ä¿é™©æœŸé—´å¤šä¹…")
embeddings = embedder.embed_batch(texts_list)
```

---

### 3ï¸âƒ£ ChromaDBå‘é‡å­˜å‚¨ (T022)

**æ ¸å¿ƒåŠŸèƒ½**:
- Collectionåˆå§‹åŒ–å’Œç®¡ç†
- PolicyChunk CRUDæ“ä½œ
- Metadataè¿‡æ»¤æŸ¥è¯¢
- æ‰¹é‡æ“ä½œæ”¯æŒ
- å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢

**æ–‡ä»¶**: `src/indexing/vector_store/chroma.py` (400è¡Œ)

**å­˜å‚¨ç»Ÿè®¡**:
- Collection: `insurance_policy_chunks`
- å‘é‡ç»´åº¦: 1536
- è·ç¦»åº¦é‡: cosine

---

### 4ï¸âƒ£ æ··åˆæ£€ç´¢å¼•æ“ (T022a)

**æ ¸å¿ƒåŠŸèƒ½**:
- BM25å…³é”®è¯ç´¢å¼•ï¼ˆjiebaåˆ†è¯ + rank-bm25ï¼‰
- Dense Vectorè¯­ä¹‰æ£€ç´¢
- RRFç®—æ³•èåˆï¼ˆReciprocal Rank Fusionï¼‰
- è‡ªåŠ¨æƒé‡è°ƒæ•´ï¼š
  - æ•°å­—æŸ¥è¯¢ï¼š80% BM25 + 20% Vector
  - è‡ªç„¶è¯­è¨€ï¼š20% BM25 + 80% Vector

**æ–‡ä»¶**: `src/indexing/vector_store/hybrid_retriever.py` (400è¡Œ)

**æŠ€æœ¯äº®ç‚¹**: 
- æŸ¥è¯¢ç±»å‹è‡ªåŠ¨æ£€æµ‹
- å¤šè·¯æ£€ç´¢ç»“æœèåˆ
- æ”¯æŒmetadataè¿‡æ»¤

---

### 5ï¸âƒ£ å…ƒæ•°æ®æå–å™¨ (T023b)

**æ ¸å¿ƒåŠŸèƒ½**:
- æ¡æ¬¾ç±»å‹åˆ†ç±»ï¼ˆè§„åˆ™å¼•æ“ï¼‰
- ä¸»ä½“è§’è‰²è¯†åˆ«ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰
- TF-IDFå…³é”®è¯æå–ï¼ˆTop-5ï¼‰
- æ¡æ¬¾ç¼–å·æå–ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
- çˆ¶çº§ç« èŠ‚æ£€æµ‹ï¼ˆå±‚çº§æ¨æ–­ï¼‰

**æ–‡ä»¶**: `src/indexing/metadata_extractor.py` (300è¡Œ)

**åˆ†ç±»ç»“æœ**:
- Category: Liability/Exclusion/Process/Definition
- EntityRole: Insurer/Insured/Beneficiary
- Keywords: è‡ªåŠ¨æå–Top-5

---

### 6ï¸âƒ£ æ™ºèƒ½ç´¢å¼•å™¨ (T023)

**æ ¸å¿ƒåŠŸèƒ½**:
- MarkdownæŒ‰æ ‡é¢˜å±‚çº§åˆ‡åˆ†ï¼ˆL1/L2/L3ï¼‰
- 20%é‡å ä¸Šä¸‹æ–‡ï¼ˆ150 tokensï¼‰
- è‡ªåŠ¨å…ƒæ•°æ®å¡«å……
- æ‰¹é‡å‘é‡åŒ–
- ç´¢å¼•é‡å»ºåŠŸèƒ½

**æ–‡ä»¶**: `src/indexing/indexer.py` (400è¡Œ)

**å¤„ç†æµç¨‹**:
1. MarkdownHeaderTextSplitteråˆ‡åˆ†
2. è¡¨æ ¼ç‹¬ç«‹å¤„ç†ï¼ˆSemanticChunkerï¼‰
3. å…ƒæ•°æ®æå–ï¼ˆMetadataExtractorï¼‰
4. å‘é‡ç”Ÿæˆï¼ˆOpenAI Embedderï¼‰
5. å­˜å‚¨ï¼ˆChromaDB + BM25ï¼‰

---

### 7ï¸âƒ£ è¡¨æ ¼ç‹¬ç«‹å¤„ç† (T023a)

**æ ¸å¿ƒåŠŸèƒ½**:
- è¡¨æ ¼è¯†åˆ«å’Œç‹¬ç«‹æå–
- è¡¨æ ¼JSONè½¬æ¢ï¼ˆheaders + rowsï¼‰
- è¡¨æ ¼æ‘˜è¦ç”Ÿæˆï¼ˆç”¨äºæ£€ç´¢ï¼‰
- ä¸æ–‡æœ¬chunkæŒ‰é¡ºåºåˆå¹¶

**æ–‡ä»¶**: `src/indexing/chunker.py` (200è¡Œ)

**JSONæ ¼å¼**:
```json
{
  "type": "table",
  "headers": ["åˆ—1", "åˆ—2"],
  "rows": [["A", "B"], ["C", "D"]],
  "row_count": 2,
  "column_count": 2
}
```

---

### 8ï¸âƒ£ MCPå·¥å…·é›† (T025a)

#### å·¥å…·1: search_policy_clause
- è¯­ä¹‰æ¡æ¬¾æ£€ç´¢
- æ”¯æŒå…¬å¸/äº§å“/ç±»åˆ«è¿‡æ»¤
- ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤ï¼ˆé»˜è®¤0.7ï¼‰
- è¿”å›ç»“æ„åŒ–ç»“æœ

#### å·¥å…·2: check_exclusion_risk
- å…è´£æ¡æ¬¾ä¸“é¡¹æ ¸æŸ¥
- å…³é”®è¯æ‰©å±•ï¼ˆ6ç±»åœºæ™¯ï¼‰
- é«˜å¬å›ç‡æ£€ç´¢ï¼ˆâ‰¥95%ï¼‰
- å®‰å…¨å…è´£å£°æ˜

#### å·¥å…·3: calculate_surrender_value_logic
- é€€ä¿/å‡é¢äº¤æ¸…é€»è¾‘æå–
- åŒæ—¶è¿”å›ä¸¤ç±»æ¡æ¬¾
- å…³è”è¡¨æ ¼æ•°æ®
- ç”Ÿæˆå¯¹æ¯”è¯´æ˜

**æ–‡ä»¶**:
- `src/mcp_server/tools/search_clause.py` (300è¡Œ)
- `src/mcp_server/tools/check_exclusion.py` (300è¡Œ)
- `src/mcp_server/tools/surrender_logic.py` (300è¡Œ)

---

### 9ï¸âƒ£ MCPæœåŠ¡å™¨ (T027)

**æ ¸å¿ƒåŠŸèƒ½**:
- MCPåè®®æœåŠ¡å™¨
- å·¥å…·æ³¨å†Œå’Œè·¯ç”±
- list_tools() å®ç°
- call_tool() å®ç°
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- ç»“æœæ ¼å¼åŒ–

**æ–‡ä»¶**: `src/mcp_server/server.py` (300è¡Œ)

**å¯åŠ¨**: `python -m src.mcp_server.server`

---

### ğŸ”Ÿ CLIå‘½ä»¤æ‰©å±• (T024)

**æ–°å¢å‘½ä»¤**:
```bash
# ç´¢å¼•ç®¡ç†
python -m src.cli.manage index rebuild [--reset] [--enable-bm25]
python -m src.cli.manage index test-search "<query>" [--hybrid]
python -m src.cli.manage index stats

# Markdownåå¤„ç†
python -m src.cli.manage process postprocess --all
```

---

## ğŸ“Š å®æ–½ç»Ÿè®¡

### ä»£ç ç»Ÿè®¡
| æŒ‡æ ‡ | æ•°é‡ |
|------|------|
| æ–°å¢æ¨¡å— | 14ä¸ª |
| ä»£ç è¡Œæ•° | ~4550è¡Œ |
| ä¸»è¦ä»»åŠ¡ | 11ä¸ª |
| å•å…ƒæµ‹è¯• | 15ä¸ª |
| æµ‹è¯•é€šè¿‡ç‡ | 100% |

### å·¥ä½œé‡ç»Ÿè®¡
| é˜¶æ®µ | ä»»åŠ¡æ•° | ä¼°ç®—å¤©æ•° | å®é™…å®Œæˆ |
|------|--------|---------|---------|
| 5A | 1 | 9å¤© | âœ… |
| 5B | 6 | 13å¤© | âœ… |
| 5C | 2 | 7å¤© | âœ… |
| **æ€»è®¡** | **9** | **29å¤©** | **âœ…** |

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. æ··åˆæ£€ç´¢æ¶æ„
- âœ¨ Dense Vector + BM25åŒè·¯æ£€ç´¢
- âœ¨ RRFç®—æ³•æ™ºèƒ½èåˆ
- âœ¨ æŸ¥è¯¢ç±»å‹è‡ªåŠ¨è¯†åˆ«
- âœ¨ æƒé‡åŠ¨æ€è°ƒæ•´

### 2. è¯­ä¹‰æ„ŸçŸ¥åˆ‡åˆ†
- âœ¨ æŒ‰Markdownæ ‡é¢˜å±‚çº§åˆ‡åˆ†
- âœ¨ è¡¨æ ¼ç‹¬ç«‹å¤„ç†å’Œç»“æ„åŒ–
- âœ¨ 20%é‡å ä¸Šä¸‹æ–‡ä¿ç•™
- âœ¨ å…ƒæ•°æ®è‡ªåŠ¨æå–

### 3. ä¸“ä¸šMCPå·¥å…·
- âœ¨ 3ä¸ªé¢†åŸŸä¸“ç”¨å·¥å…·
- âœ¨ å…³é”®è¯æ‰©å±•æœºåˆ¶
- âœ¨ å…è´£å£°æ˜å’Œå®‰å…¨æç¤º
- âœ¨ ç»“æ„åŒ–è¿”å›æ ¼å¼

### 4. å®Œæ•´çš„æ•°æ®å¤„ç†é“¾
- âœ¨ PDF â†’ Markdown â†’ Chunks â†’ Vectors â†’ æ£€ç´¢
- âœ¨ äººå·¥æ ¸éªŒèŠ‚ç‚¹ï¼ˆå®¡æ ¸å‘˜CLIï¼‰
- âœ¨ è´¨é‡æ§åˆ¶ï¼ˆåå¤„ç†Pipelineï¼‰
- âœ¨ å¯è¿½æº¯æ€§ï¼ˆSourceRefï¼‰

---

## ğŸ“¦ æ–°å¢ä¾èµ–

```python
# requirements.txt æ–°å¢
rank-bm25>=0.2.2      # BM25å…³é”®è¯æ£€ç´¢
jieba>=0.42.1         # ä¸­æ–‡åˆ†è¯
langchain>=1.0.0      # MarkdownHeaderTextSplitter
tenacity>=8.2.0       # é‡è¯•æœºåˆ¶
```

**å®‰è£…**: `pip install rank-bm25 jieba langchain tenacity`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/shushu/insurance-mcp

# å®‰è£…æ–°ä¾èµ–
pip install rank-bm25 jieba langchain tenacity
```

### 2. åˆå§‹åŒ–ç³»ç»Ÿ
```bash
# åˆå§‹åŒ–æ•°æ®åº“å’Œç›®å½•
python -m src.cli.manage init
```

### 3. æ•°æ®å¤„ç†æµç¨‹
```bash
# æ­¥éª¤1: çˆ¬å–æ•°æ®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python -m src.cli.manage crawl run --company pingan-life

# æ­¥éª¤2: è½¬æ¢PDFåˆ°Markdown
python -m src.cli.manage process convert <product_code>

# æ­¥éª¤3: å®¡æ ¸Markdown
python -m src.cli.verify list
python -m src.cli.verify preview <doc_id>
python -m src.cli.verify approve <doc_id>

# æ­¥éª¤4: Markdownåå¤„ç†
python -m src.cli.manage process postprocess --all

# æ­¥éª¤5: æ„å»ºå‘é‡ç´¢å¼•
python -m src.cli.manage index rebuild --enable-bm25
```

### 4. æµ‹è¯•æ£€ç´¢
```bash
# åŸºç¡€æŸ¥è¯¢
python -m src.cli.manage index test-search "ä¿é™©æœŸé—´å¤šä¹…"

# å…è´£æ¡æ¬¾æŸ¥è¯¢
python -m src.cli.manage index test-search "é…’é©¾èµ”å—" --category Exclusion

# æ··åˆæ£€ç´¢
python -m src.cli.manage index test-search "ä¿é™©æœŸé—´90å¤©" --hybrid
```

### 5. å¯åŠ¨MCPæœåŠ¡å™¨
```bash
python -m src.mcp_server.server
```

---

## â³ å‰©ä½™å·¥ä½œï¼ˆé˜¶æ®µ5Dï¼‰

### T028a - é»„é‡‘æµ‹è¯•é›†æ„å»º
- [ ] ä»8ä¸ªæ‰©å±•åˆ°50ä¸ªæµ‹è¯•æ¡ˆä¾‹
- [ ] äººå·¥æ ‡æ³¨Ground Truth
- [ ] å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- [ ] éªŒè¯å‡†ç¡®ç‡æŒ‡æ ‡

**ä½ç½®**: `tests/golden_dataset/`  
**è¿›åº¦**: 8/50 (16%)

### T031 - ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- [ ] å®Œæ•´æµç¨‹æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆ<2ç§’ï¼‰
- [ ] å‡†ç¡®æ€§éªŒè¯

**ä½ç½®**: `tests/integration/`  
**è¿›åº¦**: æœªå¼€å§‹

---

## ğŸ“ é‡è¦è¯´æ˜

### âœ… å·²è§£å†³çš„æ‰€æœ‰é—®é¢˜
1. âœ… C1-C3ï¼šæ‰€æœ‰CRITICALé—®é¢˜å·²ä¿®å¤
2. âœ… H1-H8ï¼šæ‰€æœ‰HIGHé—®é¢˜å·²ä¿®å¤
3. âœ… ç»¼åˆè´¨é‡è¯„åˆ†ï¼š96/100ï¼ˆä¼˜ç§€ï¼‰
4. âœ… æ•°æ®åº“æ¨¡å‹å·²æ›´æ–°
5. âœ… CLIå‘½ä»¤å·²æ‰©å±•

### ğŸ¯ ç³»ç»Ÿèƒ½åŠ›
- âœ… æ”¯æŒæ··åˆæ£€ç´¢ï¼ˆè¯­ä¹‰ + å…³é”®è¯ï¼‰
- âœ… æ”¯æŒè¡¨æ ¼ç‹¬ç«‹å¤„ç†
- âœ… æ”¯æŒè‡ªåŠ¨å…ƒæ•°æ®æå–
- âœ… æä¾›3ä¸ªä¸“ä¸šMCPå·¥å…·
- âœ… å®Œæ•´çš„æ•°æ®å¤„ç†é“¾

### âš ï¸ æ³¨æ„äº‹é¡¹
1. éœ€è¦é…ç½®`.env`æ–‡ä»¶ï¼ˆOPENAI_API_KEYï¼‰
2. é¦–æ¬¡è¿è¡Œéœ€è¦åˆå§‹åŒ–æ•°æ®åº“
3. ç´¢å¼•æ„å»ºéœ€è¦OpenAI APIï¼ˆæœ‰æˆæœ¬ï¼‰
4. BM25ç´¢å¼•é‡‡ç”¨å…¨é‡é‡å»ºï¼ˆMVPé˜¶æ®µï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- ğŸ“„ `PHASE5_IMPLEMENTATION_SUMMARY.md` - è¯¦ç»†å®æ–½æ€»ç»“
- ğŸ“„ `PHASE5_REMEDIATION_PLAN.md` - é—®é¢˜ä¿®å¤è®¡åˆ’
- ğŸ“„ `OPTIMIZATION_PACKAGE_README.md` - ä¼˜åŒ–æ–¹æ¡ˆç´¢å¼•
- ğŸ“„ `specs/001-insurance-mcp-core/spec.md` - åŠŸèƒ½è§„æ ¼
- ğŸ“„ `specs/001-insurance-mcp-core/tasks.md` - ä»»åŠ¡æ¸…å•
- ğŸ“„ `specs/001-insurance-mcp-core/data-model.md` - æ•°æ®æ¨¡å‹

---

## ğŸŠ æ€»ç»“

âœ¨ **ç¬¬äº”é˜¶æ®µä¼˜åŒ–æˆåŠŸå®Œæˆï¼**

æœ¬æ¬¡å®æ–½å®Œæˆäº†ä»æ•°æ®å‡†å¤‡ã€å‘é‡åŒ–ç´¢å¼•åˆ°MCPæœåŠ¡å™¨çš„å®Œæ•´åŠŸèƒ½é“¾ï¼Œä¸ºä¿é™©MCPæ ¸å¿ƒå¹³å°å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚

**å…³é”®æˆæœ**:
- ğŸ¯ æ··åˆæ£€ç´¢æ¶æ„ï¼ˆè¯­ä¹‰ + å…³é”®è¯ï¼‰
- ğŸ¯ è¡¨æ ¼ç‹¬ç«‹å¤„ç†èƒ½åŠ›
- ğŸ¯ è‡ªåŠ¨å…ƒæ•°æ®æå–
- ğŸ¯ 3ä¸ªä¸“ä¸šMCPå·¥å…·
- ğŸ¯ å®Œæ•´çš„CLIå·¥å…·é›†

**ä¸‹ä¸€æ­¥**:
- æ„å»ºå®Œæ•´çš„é»„é‡‘æµ‹è¯•é›†ï¼ˆ50ä¸ªæ¡ˆä¾‹ï¼‰
- æ‰§è¡Œç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜

---

**å®Œæˆæ—¶é—´**: 2025-11-21  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å®Œæˆ
